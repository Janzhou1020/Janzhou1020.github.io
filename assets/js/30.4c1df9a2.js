(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{478:function(s,t,e){"use strict";e.r(t);var a=e(7),r=Object(a.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"nfs文件同步必须要安装的包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nfs文件同步必须要安装的包"}},[s._v("#")]),s._v(" NFS文件同步必须要安装的包")]),s._v(" "),t("p",[s._v("客户端和服务器都需要安装")]),s._v(" "),t("p",[s._v("nfs-utils，rpcbind：yum install nfs-utils rpcbind -y")]),s._v(" "),t("p",[s._v("nfs-utils 是 NFS 主要工作的软件包，包含了 NFS 服务器和客户端所需的工具和守护进程")]),s._v(" "),t("p",[s._v("NFS 本身没有做端口映射，所以需要 RPC 机制进行网络服务，rpcbind 是一个关键的组件，负责将客户端的 RPC 请求映射到实际的服务进程，总而言之，当需要 NFS 服务时，需要将 NFS 和 RPC 一起安装")]),s._v(" "),t("h2",{attrs:{id:"启动服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动服务"}},[s._v("#")]),s._v(" 启动服务")]),s._v(" "),t("p",[s._v("在服务端启动 NFS 和 RPC服务，并设置开机自启，客户端只需要启动 RPC 就可以，主要是需要 RPC 提供的守护进程")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl start rpcbind\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" rpcbind\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl start nfs-server\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" nfs-server\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h2",{attrs:{id:"在服务端共享文件设置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#在服务端共享文件设置"}},[s._v("#")]),s._v(" 在服务端共享文件设置")]),s._v(" "),t("p",[s._v("先了解共享文件语法：")]),s._v(" "),t("p",[s._v("基本语法：<directory> <host>(<options>)")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("<directory>：要共享的目录路径")]),s._v(" "),t("p",[s._v("<host>：允许访问该共享的客户端，可以是主机名、IP 地址或网络地址")]),s._v(" "),t("p",[s._v("<options>：访问选项，用逗号分隔")])])]),s._v(" "),t("p",[s._v("常用选项：")]),s._v(" "),t("ul",[t("li",[t("p",[t("code",[s._v("rw")]),s._v("：读写权限")]),s._v(" "),t("p",[t("code",[s._v("ro")]),s._v("：只读权限")]),s._v(" "),t("p",[t("code",[s._v("sync")]),s._v("：数据在请求写入时同步到磁盘")]),s._v(" "),t("p",[t("code",[s._v("async")]),s._v("：数据在请求写入时不立即同步到磁盘")]),s._v(" "),t("p",[t("code",[s._v("no_root_squash")]),s._v("：允许根用户访问（不进行 UID 映射），远程 root 用户拥有与本地 root 用户相同的权限")]),s._v(" "),t("p",[t("code",[s._v("root_squash")]),s._v("：将根用户映射为匿名用户（默认），远程 root 用户被降级为匿名用户")]),s._v(" "),t("p",[t("code",[s._v("all_squash")]),s._v("：将所有用户映射为匿名用户，所有远程用户都被降级为匿名用户")]),s._v(" "),t("p",[t("code",[s._v("subtree_check")]),s._v("：检查子目录的权限")]),s._v(" "),t("p",[t("code",[s._v("no_subtree_check")]),s._v("：不检查子目录的权限")]),s._v(" "),t("p",[t("code",[s._v("insecure")]),s._v("：允许客户端使用不安全端口（大于1024的端口）")]),s._v(" "),t("p",[t("code",[s._v("anonuid")]),s._v("：设置映射用户的UID")]),s._v(" "),t("p",[t("code",[s._v("anongid")]),s._v("：设置映射用户的GID")])])]),s._v(" "),t("p",[t("strong",[s._v("1.首先设置需要共享的文件和相关权限")])]),s._v(" "),t("p",[s._v("比如我现在需要在服务器共享 /html/www 下的文件")]),s._v(" "),t("ul",[t("li",[s._v("如果选择 no_root_squash 的方式同步文件，则无需更改文件权限")]),s._v(" "),t("li",[s._v("如果选择 root_squash 的方式同步文件，用户通常被映射为 nfsnobody:nfsnobody，需要给同步文件设置其他组的权限\n"),t("ul",[t("li",[s._v('groupadd -g 65534 nfsnobody ; useradd -u 65534 -g nfsnobody -s /sbin/nologin -c "NFS Nobody" nfsnobody')])])]),s._v(" "),t("li",[s._v("如果选择 all_squash 的方式同步文件，代表 所有用户都被映射为 匿名用户")])]),s._v(" "),t("p",[s._v("chmod -R 744 /html/www")]),s._v(" "),t("p",[s._v("如果你想严谨一点，可以设置 /html/www 下所有文件的属主和属组")]),s._v(" "),t("p",[t("strong",[s._v("2.设置共享文件")])]),s._v(" "),t("p",[s._v("vim /etc/exports")]),s._v(" "),t("p",[s._v("假如我要 /html/www 下的文件共享给 192.168.3.0/24")]),s._v(" "),t("p",[s._v("如果你的文件系统级别权限设置为“其他组只能读”（即文件或目录的权限为744），而在NFS导出选项中设置为 rw，那么最终权限是受限于文件系统级别的权限，换句话说，客户端用户会受到文件系统权限的限制，即使NFS导出选项是 rw，用户也只能读取而不能写入")]),s._v(" "),t("p",[s._v("设置为 root_squash 后，客户端会使用服务器预设的 nfsnobody 用户和组")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("/html/www "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".3.0/24"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ro,sync,root_squash,no_subtree_check"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("在更改 exports 文件后，使用 "),t("strong",[s._v("exportfs -r")]),s._v(" 重新加载该文件")]),s._v(" "),t("h2",{attrs:{id:"开放-nfs-端口和-rpc-端口"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开放-nfs-端口和-rpc-端口"}},[s._v("#")]),s._v(" 开放 NFS 端口和 RPC 端口")]),s._v(" "),t("p",[s._v("如果有云控制台，还需要额外去配置防火墙信息")]),s._v(" "),t("p",[s._v("NFS 主要使用以下端口：")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("2049：NFS 服务器端口")]),s._v(" "),t("p",[s._v("111：rpcbind 端口")]),s._v(" "),t("p",[s._v("20048：rpc.mountd 端口")])])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" firewall-cmd "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--permanent")]),s._v(" --add-port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2049")]),s._v("/tcp\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" firewall-cmd "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--permanent")]),s._v(" --add-port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2049")]),s._v("/udp\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" firewall-cmd "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--permanent")]),s._v(" --add-port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("111")]),s._v("/tcp\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" firewall-cmd "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--permanent")]),s._v(" --add-port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("111")]),s._v("/udp\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" firewall-cmd "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--permanent")]),s._v(" --add-port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20048")]),s._v("/tcp\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" firewall-cmd "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--permanent")]),s._v(" --add-port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20048")]),s._v("/udp\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h2",{attrs:{id:"客户端挂载文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#客户端挂载文件"}},[s._v("#")]),s._v(" 客户端挂载文件")]),s._v(" "),t("p",[s._v("mount -t nfs [options] <server_ip>:/remote/share /local/mount/point")]),s._v(" "),t("p",[s._v("mount -t nfs 49.235.177.56:/var/temp/ /var/temp/nfs3/")]),s._v(" "),t("p",[s._v("选项：")]),s._v(" "),t("p",[t("strong",[t("code",[s._v("-t nfs")])]),s._v(": 指定挂载的文件系统类型为 NFS")]),s._v(" "),t("p",[t("strong",[t("code",[s._v("[options]")])]),s._v(": 这里可以指定挂载选项，例如 "),t("code",[s._v("rw")]),s._v("、"),t("code",[s._v("ro")]),s._v("、"),t("code",[s._v("vers=4")]),s._v(" 等。选项用于控制挂载的行为，下面列举一些常见的选项：")]),s._v(" "),t("ul",[t("li",[t("p",[t("code",[s._v("rw")]),s._v("：以读写模式挂载")]),s._v(" "),t("p",[t("code",[s._v("ro")]),s._v("：以只读模式挂载")]),s._v(" "),t("p",[t("code",[s._v("vers=4")]),s._v("：指定 NFS 版本为 4，如果不指定，系统可能使用默认版本（通常是 NFSv3）")]),s._v(" "),t("p",[t("code",[s._v("nolock")]),s._v("：禁用锁定机制")]),s._v(" "),t("p",[t("code",[s._v("timeo=600")]),s._v("：设置挂载超时时间（以十分之一秒为单位）")])])]),s._v(" "),t("p",[t("strong",[t("code",[s._v("<server_ip>:/remote/share")])]),s._v(": 远程 NFS 服务器的 IP 地址和共享目录路径")]),s._v(" "),t("ul",[t("li",[t("p",[t("code",[s._v("<server_ip>")]),s._v(": NFS 服务器的 IP 地址或主机名")]),s._v(" "),t("p",[t("code",[s._v("/remote/share")]),s._v(": NFS 服务器上共享的目录路径，确保这个路径在 NFS 服务器的 "),t("code",[s._v("/etc/exports")]),s._v(" 文件中正确配置并导出")])])]),s._v(" "),t("p",[t("strong",[t("code",[s._v("/local/mount/point")])]),s._v(": 本地挂载点目录，即 NFS 共享目录将被挂载到本地文件系统的哪个目录，这个目录必须在客户端系统中存在且为空")]),s._v(" "),t("h2",{attrs:{id:"nfs-设置永久挂载"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nfs-设置永久挂载"}},[s._v("#")]),s._v(" NFS 设置永久挂载")]),s._v(" "),t("p",[s._v("vim /etc/fstab")]),s._v(" "),t("p",[s._v("添加类似：server_ip:/exported/directory /mnt/nfs_share nfs defaults 0 0")]),s._v(" "),t("ul",[t("li",[t("p",[t("code",[s._v("server_ip")]),s._v(" 是 NFS 服务器的 IP 地址或主机名")]),s._v(" "),t("p",[t("code",[s._v("/exported/directory")]),s._v(" 是 NFS 服务器上导出的目录")]),s._v(" "),t("p",[t("code",[s._v("/mnt/nfs_share")]),s._v(" 是客户端系统上的挂载点目录")]),s._v(" "),t("p",[t("code",[s._v("nfs")]),s._v(" 是文件系统类型")]),s._v(" "),t("p",[t("code",[s._v("defaults")]),s._v(" 是挂载选项，可以根据需要进行调整")])])]),s._v(" "),t("p",[s._v("在编辑 /etc/fstab 之后，可以直接用 mount -a 挂载")]),s._v(" "),t("p",[s._v("验证挂载：df -h")])])}),[],!1,null,null,null);t.default=r.exports}}]);