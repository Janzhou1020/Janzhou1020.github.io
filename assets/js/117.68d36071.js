(window.webpackJsonp=window.webpackJsonp||[]).push([[117],{567:function(a,t,s){"use strict";s.r(t);var e=s(7),n=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("p",[a._v("Grafana是一个监控仪表系统，它是由Grafana Labs公司开发的的一个系统检测工具，它可以大大的帮助我们简化监控的复杂度，我们只需要提供监控的数据，它就可以帮助生成各种可视化仪表，同时它还具有报警功能，可以在系统出现问题的时候发出通知")]),a._v(" "),t("h3",{attrs:{id:"安装和启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装和启动"}},[a._v("#")]),a._v(" 安装和启动")]),a._v(" "),t("p",[a._v("下载 grafana：yum install -y https://dl.grafana.com/enterprise/release/grafana-enterprise-10.4.2-1.x86_64.rpm")]),a._v(" "),t("p",[a._v("yum install grafana-10.4.2-1.x86_64.rpm -y")]),a._v(" "),t("p",[a._v("安装后启动：systemctl start grafana-server")]),a._v(" "),t("p",[a._v("启动报错了")]),a._v(" "),t("div",{staticClass:"language-log line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-log"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("@")]),a._v("localhost soft"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("#")]),a._v(" journalctl "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("u "),t("span",{pre:!0,attrs:{class:"token domain constant"}},[a._v("grafana-server.service")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("n "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("50")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v(" Logs begin at 五 "),t("span",{pre:!0,attrs:{class:"token date number"}},[a._v("2024-12-20")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token time number"}},[a._v("00:28:20")]),a._v(" CST"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" end at 四 "),t("span",{pre:!0,attrs:{class:"token date number"}},[a._v("2024-12-19")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token time number"}},[a._v("17:20:35")]),a._v(" CST"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("12")]),a._v("月 "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("19")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token time number"}},[a._v("17:20:34")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token domain constant"}},[a._v("localhost.localdomain")]),a._v(" grafana"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("30734")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" logger"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("ngalert"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("migration t"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token date number"}},[a._v("2024-12-19T")]),t("span",{pre:!0,attrs:{class:"token time number"}},[a._v("17:20:34.83176")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("12")]),a._v("月 "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("19")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token time number"}},[a._v("17:20:34")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token domain constant"}},[a._v("localhost.localdomain")]),a._v(" grafana"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("30734")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" logger"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("ngalert"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("state"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("manager t"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token date number"}},[a._v("2024-12-19T")]),t("span",{pre:!0,attrs:{class:"token time number"}},[a._v("17:20:34.8")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("12")]),a._v("月 "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("19")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token time number"}},[a._v("17:20:34")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token domain constant"}},[a._v("localhost.localdomain")]),a._v(" grafana"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("30734")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" logger"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("infra"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("usagestats"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("collector t"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token date number"}},[a._v("2024-12-19T")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("17")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("20")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("12")]),a._v("月 "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("19")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token time number"}},[a._v("17:20:34")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token domain constant"}},[a._v("localhost.localdomain")]),a._v(" grafana"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("30734")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" logger"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("server t"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token date number"}},[a._v("2024-12-19T")]),t("span",{pre:!0,attrs:{class:"token time number"}},[a._v("17:20:34.846483039+08:00")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("12")]),a._v("月 "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("19")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token time number"}},[a._v("17:20:34")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token domain constant"}},[a._v("localhost.localdomain")]),a._v(" grafana"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("30734")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" Error"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" ✗ failed to verify pid directory"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" mkdir "),t("span",{pre:!0,attrs:{class:"token file-path string"}},[a._v("/var/")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("12")]),a._v("月 "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("19")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token time number"}},[a._v("17:20:34")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token domain constant"}},[a._v("localhost.localdomain")]),a._v(" systemd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" grafana"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("server"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("service"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" main process exited"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" code"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("exited\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("12")]),a._v("月 "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("19")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token time number"}},[a._v("17:20:34")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token domain constant"}},[a._v("localhost.localdomain")]),a._v(" systemd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" Failed to start Grafana instance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("12")]),a._v("月 "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("19")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token time number"}},[a._v("17:20:34")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token domain constant"}},[a._v("localhost.localdomain")]),a._v(" systemd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" Unit "),t("span",{pre:!0,attrs:{class:"token domain constant"}},[a._v("grafana-server.service")]),a._v(" entered failed state"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("12")]),a._v("月 "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("19")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token time number"}},[a._v("17:20:34")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token domain constant"}},[a._v("localhost.localdomain")]),a._v(" systemd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token domain constant"}},[a._v("grafana-server.service")]),a._v(" holdoff time over"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" scheduling res\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("12")]),a._v("月 "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("19")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token time number"}},[a._v("17:20:34")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token domain constant"}},[a._v("localhost.localdomain")]),a._v(" systemd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" Stopping Grafana instance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("12")]),a._v("月 "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("19")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token time number"}},[a._v("17:20:34")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token domain constant"}},[a._v("localhost.localdomain")]),a._v(" systemd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" Starting Grafana instance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("12")]),a._v("月 "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("19")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token time number"}},[a._v("17:20:35")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token domain constant"}},[a._v("localhost.localdomain")]),a._v(" grafana"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("30763")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" logger"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("settings t"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token date number"}},[a._v("2024-12-19T")]),t("span",{pre:!0,attrs:{class:"token time number"}},[a._v("17:20:35.13608298+08:00")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("12")]),a._v("月 "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("19")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token time number"}},[a._v("17:20:35")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token domain constant"}},[a._v("localhost.localdomain")]),a._v(" grafana"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("30763")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" logger"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("settings t"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token date number"}},[a._v("2024-12-19T")]),t("span",{pre:!0,attrs:{class:"token time number"}},[a._v("17:20:35.136566961")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("08")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("12")]),a._v("月 "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("19")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token time number"}},[a._v("17:20:35")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token domain constant"}},[a._v("localhost.localdomain")]),a._v(" grafana"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("30763")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" logger"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("settings t"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token date number"}},[a._v("2024-12-19T")]),t("span",{pre:!0,attrs:{class:"token time number"}},[a._v("17:20:35.136600714")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("08")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\nlines "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("15")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br")])]),t("p",[a._v("从日志来看，Grafana 服务启动失败的主要原因是以下错误：Error: ✗ failed to verify pid directory: mkdir /var/")]),a._v(" "),t("p",[a._v("表明 Grafana 无法创建或访问 pid 文件所需的目录 /var/run/grafana-server，可能是权限问题或路径不存在")]),a._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" /var/run/grafana-server\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("chown")]),a._v(" grafana:grafana /var/run/grafana-server\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 确保 /var 目录没有被意外修改，应该有以下权限")]),a._v("\ndrwxr-xr-x. "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("21")]),a._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4096")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("日期时间"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" /var\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 如果权限被更改，修复为")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("755")]),a._v(" /var\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 如果 /var/run 是临时文件系统（会在重启后清空），可以将 pid 文件位置改为其他永久目录，例如 /var/lib/grafana")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vi")]),a._v(" /usr/lib/systemd/system/grafana-server.service\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 找到以下内容 --pidfile=${PID_FILE_DIR}/grafana-server.pid")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 将 ${PID_FILE_DIR} 替换为 /var/lib/grafana")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--pidfile")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/var/lib/grafana/grafana-server.pid\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" systemctl daemon-reload\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 再次启动 grafana 成功了，默认端口为 3000")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br")])]),t("p",[a._v("访问：IP:3000")]),a._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20241219173044273.png",alt:"image-20241219173044273"}}),a._v(" "),t("p",[a._v("默认用户名密码：admin/admin")]),a._v(" "),t("h3",{attrs:{id:"整合-prometheus"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#整合-prometheus"}},[a._v("#")]),a._v(" 整合 Prometheus")]),a._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20241219173557540.png",alt:"image-20241219173557540"}}),a._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20241219173622520.png",alt:"image-20241219173622520"}}),a._v(" "),t("p",[a._v("填写 Prometheus 的地址")]),a._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20241219173647079.png",alt:"image-20241219173647079"}}),a._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20241219173728725.png",alt:"image-20241219173728725"}}),a._v(" "),t("p",[a._v("添加后的状态")]),a._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20241219173757965.png",alt:"image-20241219173757965"}}),a._v(" "),t("h3",{attrs:{id:"实现-cpu-负载监控"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实现-cpu-负载监控"}},[a._v("#")]),a._v(" 实现 CPU 负载监控")]),a._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20241219173903971.png",alt:"image-20241219173903971"}}),a._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20241219173932770.png",alt:"image-20241219173932770"}}),a._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20241219174004470.png",alt:"image-20241219174004470"}}),a._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20241219175546657.png",alt:"image-20241219175546657"}}),a._v(" "),t("p",[a._v("通过自定义的 PromQL 来获取监控数据")]),a._v(" "),t("p",[t("img",{staticStyle:{zoom:"50%"},attrs:{src:"/img/image-20241226094053861.png",alt:"image-20241226094053861"}}),a._v("因为可能涉及到我们的主机会比较多，所以集合在一起的话不太直观，所以我们完全可以通过参数来实现各个主机展示各个图标")]),a._v(" "),t("p",[t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20241226095158386.png",alt:"image-20241226095158386"}}),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20241226095316113.png",alt:"image-20241226095316113"}}),a._v("这里有两种获取主机的方式：")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('1.使用up{job="node_exporter"}过滤主机，然后使用regex正则匹配.*instance="(.*?)".*\n2.直接使用函数label_values取标签label_values(up{job="node_exporter"}, instance)\n')])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])]),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20241226112521367.png",alt:"image-20241226112521367"}}),a._v(" "),t("p",[a._v("此时选择节点仍然不会生效预期结果")]),a._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20241226112847488.png",alt:"image-20241226112847488"}}),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('PromQL：(1 - sum (increase(node_cpu_seconds_total{instance=~"$host",mode="idle"}[1m])) by(instance) / sum (increase(node_cpu_seconds_total{instance=~"$host"}[1m])) by(instance)) * 100\n')])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("当我们把过滤标签替换成变量之后我们上上面选择的是哪儿个它就会给我们把变量传递到PromQL进行查询")]),a._v(" "),t("p",[t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20241226113540802.png",alt:"image-20241226113540802"}}),a._v("这样我们的参数就替换好了")]),a._v(" "),t("p",[a._v("添加对时间序列的描述")]),a._v(" "),t("p",[t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20241226140033673.png",alt:"image-20241226140033673"}}),a._v("Transform：它支持我们的数据在展示之前多数据进行操作")]),a._v(" "),t("p",[a._v("这里我们用到了 Rename by regex 来重命名我们的数据")]),a._v(" "),t("p",[t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20241226142746418.png",alt:"image-20241226142746418"}}),a._v("这里主要是我们匹配 :9100 这个数据然后 $1 就是我们的主机名，意思就是他会把匹配到的 9100 的所有的值全部替换成 $1 也就是我们的主机名")]),a._v(" "),t("p",[a._v("我们都知道我们在计算的时候其实 cpu 的使用率都乘 100 了，那么我们其实还可以做一下配置")]),a._v(" "),t("p",[a._v("在右侧选择 Standard options ---\x3e Unit ---\x3e Misc ---\x3e Percent(0-100)(百分比)\nDecimals （保留小数的最小位数）")]),a._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20241226144656917.png",alt:"image-20241226144656917"}}),a._v(" "),t("p",[t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20241226144834360.png",alt:"image-20241226144834360"}}),a._v("在这里面还有一个问题，就是我们在执行图形的查询的时候区间向量都是一分钟，但是有的时候我们需要查询的不只是一分钟，所以我们需要把这个数值改成参数的形式，和host类似的写法")]),a._v(" "),t("p",[t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20241226151353412.png",alt:"image-20241226151353412"}}),a._v(" 遵循host的替换规则，我们也把interval替换上去，然后上图就是替换好的一个样子了")]),a._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20241226152650119.png",alt:"image-20241226152650119"}}),a._v(" "),t("h3",{attrs:{id:"监控模型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#监控模型"}},[a._v("#")]),a._v(" 监控模型")]),a._v(" "),t("p",[a._v("除了用默认的时间序列面板外，还有许多其他的面板")]),a._v(" "),t("h4",{attrs:{id:"表格面板"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#表格面板"}},[a._v("#")]),a._v(" 表格面板")]),a._v(" "),t("p",[a._v("表格面板可视化非常的灵活，支持时间序列和表格和原始 json 数据的多种样式，此面板还提供日期格式，值格式和着色选项")]),a._v(" "),t("p",[a._v("接下来我们演示一下统计服务器资源为例使用表格面板进行说明，在 Dashboard 中添加一个空的 Panel 面板进入面板后选择 Table 面板")]),a._v(" "),t("ol",[t("li",[a._v("在右上角选择面板类型， (1) 选择 Table")]),a._v(" "),t("li",[a._v("修改左下 Query 面板中， (2) 将 Format 修改为 Table,  (3) Type 修改为 Instant")]),a._v(" "),t("li",[a._v("在面板的展示区， 将以表格形式出现。点击 (4) 刷新按钮， 立即更新查询内容。尤其是在每次修改后， 都建议点一下")]),a._v(" "),t("li",[a._v("在右边 (5) All 配置区， 可以配置界面的基本信息")]),a._v(" "),t("li",[a._v("在右边 (6) Overrides 配置区， 针对表格字段进行 高级配置")])]),a._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20241227112459676.png",alt:"image-20241227112459676"}}),a._v(" "),t("p",[t("strong",[a._v("字段高级配置")])]),a._v(" "),t("p",[a._v("进行字段的展示筛选， 有两种方法。就个人而言， 更喜欢白名单方法")]),a._v(" "),t("ol",[t("li",[a._v("白名单方法：即 (1) 隐藏所有字段， (2) 在展示需要字段")]),a._v(" "),t("li",[a._v("黑名单方法：即直接隐藏不需要的字段")])]),a._v(" "),t("p",[a._v("先来看下最终效果")]),a._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20241228111923125.png",alt:"image-20241228111923125"}}),a._v(" "),t("p",[a._v("PromQL")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('node_uname_info{job="node_exporter"}\n(node_memory_MemTotal_bytes - node_memory_MemFree_bytes - node_memory_Buffers_bytes - node_memory_Cached_bytes) / node_memory_MemTotal_bytes * 100\nnode_memory_MemTotal_bytes / 1024 / 1024\ncount(count(node_cpu_seconds_total) by (instance, cpu)) by (instance)\nnode_load5\nnode_netstat_Tcp_CurrEstab\nrate(node_network_transmit_bytes_total{device="eno16777736"}[1m]) * 8 / 1e6\nrate(node_network_receive_bytes_total{device="eno16777736"}[1m]) * 8 / 1e6\n')])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br")])]),t("p",[t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20241228112204139.png",alt:"image-20241228112204139"}}),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20241228112415502.png",alt:"image-20241228112415502"}}),a._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20241228112515225.png",alt:"image-20241228112515225"}}),a._v("当时遇到的问题，在使用 LED 装饰内存使用率图标时，发现百分比和 LED 灯的数量对不上，60% 时 LED 就全亮了，后来发现需要在 "),t("strong",[a._v("ALL")]),a._v(" 全局配置中设置 Percent 的最大值 0 和最小值 100")]),a._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20241228112849666.png",alt:"image-20241228112849666"}}),a._v(" "),t("h4",{attrs:{id:"仪表盘-gauge"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#仪表盘-gauge"}},[a._v("#")]),a._v(" 仪表盘（Gauge）")]),a._v(" "),t("p",[a._v("如果想展示最大值与最小值相关的数据，我们可以选择使用仪表盘面板，比如我们用一个仪表盘面板来展示内存使用率")]),a._v(" "),t("p",[a._v("PromQL：100 * (1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes))")]),a._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20241228095315275.png",alt:"image-20241228095315275"}}),a._v(" "),t("p",[a._v("除了上面瞄准的仪表盘外，还有条形式仪表盘，该面板可以显示一个或多个条形仪表，同样我们可以用来展示CPU使用率内存使用率等")]),a._v(" "),t("p",[t("strong",[a._v("Bar Gauge")])]),a._v(" "),t("p",[t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20241228121108530.png",alt:"image-20241228121108530"}}),a._v("整体效果看一下（自行排版）")]),a._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20241228121218231.png",alt:"image-20241228121218231"}}),a._v(" "),t("h4",{attrs:{id:"_9-4-3-统计面板-stat"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-4-3-统计面板-stat"}},[a._v("#")]),a._v(" 9.4.3 统计面板（Stat）")]),a._v(" "),t("p",[a._v("统计面板可以用于显示一个大的统计值和一个可选的背景色，我们可以使用阈值来控制背景色或者颜色值，接下来我们使用该面板来统计几个监控数据，比如节点运行时间，CPU核心数，总内存大小等等")]),a._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20241228122331461.png",alt:"image-20241228122331461"}}),a._v(" "),t("h4",{attrs:{id:"文本面板-text"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#文本面板-text"}},[a._v("#")]),a._v(" 文本面板（Text）")]),a._v(" "),t("p",[a._v("该面板不需要查询语句，直接用来展示文本信息，而且是支持 Markdown 和 HTML 两种格式，这就为我们提供了很大的定制灵活性")]),a._v(" "),t("p",[a._v("文本面板的使用非常简单，直接选择使用 Markdown 还是 HTML 来设置文本样式即可，然后在面板编辑器的文本框中输入内容即可。比如很多公司业务太大太多，需要监控的 Dashboard 非常多，操作管理起来非常麻烦，这个时候我们就可以使用文本面板来做一个导航页面进行归类")]),a._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20241228122727064.png",alt:"image-20241228122727064"}}),a._v(" "),t("p",[a._v("整体看一下")]),a._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20241228122850513.png",alt:"image-20241228122850513"}}),a._v(" "),t("p",[a._v("当然了这里支持 HTML 与 MarkDown 的语法，我这里使用的是 MarkDown 语法来写的一个简单的页面")]),a._v(" "),t("h3",{attrs:{id:"通过模板的方式实现监控"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#通过模板的方式实现监控"}},[a._v("#")]),a._v(" 通过模板的方式实现监控")]),a._v(" "),t("p",[a._v("https://grafana.com/grafana/dashboards/")]),a._v(" "),t("p",[a._v("在官网下载 JSON 或是通过 Dashboard ID 导入")]),a._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20241219204133202.png",alt:"image-20241219204133202"}}),a._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20241219204213024.png",alt:"image-20241219204213024"}}),a._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20241219204231954.png",alt:"image-20241219204231954"}}),a._v(" "),t("p",[a._v("使用 cat /dev/urandom | gzip -9 > /dev/null 压测系统，观察 CPU 变化")]),a._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20241219204534535.png",alt:"image-20241219204534535"}}),a._v(" "),t("h3",{attrs:{id:"通过模板的方式监控-mariadb"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#通过模板的方式监控-mariadb"}},[a._v("#")]),a._v(" 通过模板的方式监控 mariadb")]),a._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20241219204649964.png",alt:"image-20241219204649964"}}),a._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20241219204817911.png",alt:"image-20241219204817911"}})])}),[],!1,null,null,null);t.default=n.exports}}]);