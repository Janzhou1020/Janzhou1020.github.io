(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{519:function(a,t,e){"use strict";e.r(t);var s=e(7),i=Object(s.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("p",[t("strong",[a._v("大坑：由于没有更换 StartJavaPollers 属性值，导致 jmx 连接一直有问题")])]),a._v(" "),t("p",[a._v("前提：防火墙都关闭")]),a._v(" "),t("p",[a._v("先快速安装 jdk 和 tomcat，部署一个简单的 web 应用")]),a._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20240824111305301.png",alt:"image-20240824111305301"}}),a._v(" "),t("p",[a._v("tomcat 开启远程监控功能")]),a._v(" "),t("p",[a._v("vim ./bin/catalina.sh，加入以下行，\\ 代表续行符")]),a._v(" "),t("p",[a._v("不能加到太后面，可以从注释没有的那行开始（108行）")]),a._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("CATALINA_OPTS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$CATALINA_OPTS")]),a._v(' \\\n-Dcom.sun.management.jmxremote \\\n-Dcom.sun.management.jmxremote.port=9010 \\\n-Dcom.sun.management.jmxremote.authenticate=false \\\n-Dcom.sun.management.jmxremote.ssl=false \\\n-Djava.rmi.server.hostname=10.0.0.21（本机IP）"')]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br")])]),t("p",[a._v("随后重启 tomcat")]),a._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20240824161609282.png",alt:"image-20240824161609282"}}),a._v(" "),t("p",[a._v("在 zabbix 服务端安装 java-gateway（连接工具）：yum list | grep -i java-gateway")]),a._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20240824113703336.png",alt:"image-20240824113703336"}}),a._v(" "),t("p",[a._v("根据需要修改 zabbix-java-gateway 配置文件")]),a._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20240824141226531.png",alt:"image-20240824141226531"}}),a._v(" "),t("p",[a._v("调整 zabbix_server.conf 的配置，指向 zabbix-java-gateway，由于 zabbix-java-gateway 是在服务器本机部署的，所以指向本地")]),a._v(" "),t("p",[t("strong",[t("code",[a._v("StartJavaPollers")])]),a._v("：指定用于与 Java 应用程序交互的 Java Pollers 的数量，如果为 0，在新建 zabbix 主机进行 jmx 模式进行监控时会报错：[Runtime: JVM is not reachable](javascript:void(0))")]),a._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20240824161713124.png",alt:"image-20240824161713124"}})]),a._v(" "),t("p",[a._v("设置开机自启，启动 zabbix-java-gateway，注意 jdk 版本不得低于 1.8，随后重启 zabbix server")]),a._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20240824143144697.png",alt:"image-20240824143144697"}}),a._v(" "),t("p",[a._v("用 cmdline-jmxclient-0.10.3.jar 工具测试连接：java -jar cmdline-jmxclient-0.10.3.jar - 10.0.0.21:9010")]),a._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20240824144819690.png",alt:"image-20240824144819690"}}),a._v(" "),t("p",[a._v("接下来进行 zabbix server 配置")]),a._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20240824162031896.png",alt:"image-20240824162031896"}}),a._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20240824162105639.png",alt:"image-20240824162105639"}}),a._v(" "),t("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20240824162118670.png",alt:"image-20240824162118670"}}),a._v(" "),t("p",[t("strong",[a._v("java应用监控方案2")]),a._v("：通过 jmap/jstat 实现自定义监控（不需要安装 java-gateway，【tomcat】不需要开启远程监控功能）")]),a._v(" "),t("p",[a._v("用户输入参数 可以是应用名称，根据应用名称找出应用 pid，根据 pid 导出 jmap -heap pid jvm 内存使用情况")]),a._v(" "),t("p",[a._v("继续过滤，DIY 自己需要的信息和模板")])])}),[],!1,null,null,null);t.default=i.exports}}]);