(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{482:function(s,n,a){"use strict";a.r(n);var t=a(7),e=Object(t.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("p",[s._v("MySQL 的主主模式（也称为双主复制或双向复制）是一种高级的数据库复制配置，其中两台 MySQL 服务器彼此互为主服务器和从服务器。这种模式允许在两台服务器上同时进行读写操作，并将变更复制到对方，从而实现高可用性和负载均衡")]),s._v(" "),n("p",[s._v("主主模式的原理")]),s._v(" "),n("ul",[n("li",[n("strong",[s._v("双向复制")]),s._v("：在主主模式中，每台服务器既充当主服务器，也充当从服务器。A 服务器上的所有更改会复制到 B 服务器，反之亦然。")]),s._v(" "),n("li",[n("strong",[s._v("自动故障转移")]),s._v("：如果其中一台服务器发生故障，另一台服务器可以继续提供服务，保证了系统的高可用性。")]),s._v(" "),n("li",[n("strong",[s._v("负载均衡")]),s._v("：通过将读写请求分散到两台服务器上，可以分担系统的压力。")])]),s._v(" "),n("p",[s._v("准备两台 PC，都安装好相近版本的 mysql，可以互相 ping 通，提前开放好 mysql 端口")]),s._v(" "),n("p",[n("strong",[s._v("主机A配置：")])]),s._v(" "),n("p",[s._v("1.编辑 my.cnf")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nserver-id"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nlog-bin"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql-bin\nauto-increment-increment"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\nauto-increment-offset"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#server-id=1：指定服务器 A 的唯一 ID")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#log-bin=mysql-bin：启用二进制日志")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#auto-increment-increment=2 和 auto-increment-offset=1：用于防止自增列冲突（详情见后）")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("2.创建从机复制用户")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("CREATE USER 'zzl'@'10.0.0.23' IDENTIFIED BY '123456zzlZZL!';\nGRANT REPLICATION SLAVE ON *.* TO 'zzl'@'10.0.0.23';\nFLUSH PRIVILEGES;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("3.重启 mysql")]),s._v(" "),n("p",[n("strong",[s._v("主机B配置：")])]),s._v(" "),n("p",[s._v("1.编辑 my.cnf")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nserver-id"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\nlog-bin"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql-bin\nauto-increment-increment"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\nauto-increment-offset"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("2.创建从机复制用户")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("CREATE USER 'zzl'@'10.0.0.22' IDENTIFIED BY '123456zzlZZL!';\nGRANT REPLICATION SLAVE ON *.* TO 'zzl'@'10.0.0.22';\nFLUSH PRIVILEGES;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("3.重启 mysql")]),s._v(" "),n("p",[n("strong",[s._v("设置双向复制")])]),s._v(" "),n("p",[s._v("在主机A中，设置如下：")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("CHANGE MASTER TO\nMASTER_HOST='10.0.0.23',\nMASTER_USER='zzl',\nMASTER_PASSWORD='123456zzlZZL!',\nMASTER_LOG_FILE='mysql-bin.000003',\nMASTER_LOG_POS=154;\nSTART SLAVE;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("在主机B中，配置如下：")]),s._v(" "),n("div",{staticClass:"language-mysql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("CHANGE MASTER TO\nMASTER_HOST='10.0.0.22',\nMASTER_USER='zzl',\nMASTER_PASSWORD='123456zzlZZL!',\nMASTER_LOG_FILE='mysql-bin.000001',\nMASTER_LOG_POS=154;\nSTART SLAVE;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("结果如下：")]),s._v(" "),n("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20240813171527553.png",alt:"image-20240813171527553"}}),s._v(" "),n("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20240813171547088.png",alt:"image-20240813171547088"}})])}),[],!1,null,null,null);n.default=e.exports}}]);