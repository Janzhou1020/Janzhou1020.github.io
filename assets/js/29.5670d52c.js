(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{478:function(s,a,e){"use strict";e.r(a);var t=e(7),r=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("rsync 是一个快速、通用的文件和目录同步工具。它支持本地和远程的数据同步，并能够保持文件权限、时间戳、软硬链接等属性")]),s._v(" "),a("h2",{attrs:{id:"语法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#语法"}},[s._v("#")]),s._v(" 语法")]),s._v(" "),a("p",[a("strong",[s._v("rsync [选项] 源 目标")])]),s._v(" "),a("p",[s._v("选项：")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("-a 或 --archive：归档模式，等同于 -rlptgoD，表示递归传输文件并保持文件属性\n-v 或 --verbose：显示详细的输出信息\n-z 或 --compress：在传输过程中压缩文件\n-r 或 --recursive：递归传输目录中的所有文件\n-l 或 --links：保持符号链接\n-p 或 --perms：保持文件权限\n-t 或 --times：保持文件时间\n-g 或 --group：保持文件组\n-o 或 --owner：保持文件所有者\n-D：保持设备文件和特殊文件，等同于 --devices --specials\n--delete：删除目标目录中在源目录中不存在的文件\n--progress：显示传输过程的进度条\n--exclude：排除指定的文件或目录\n--include：包含指定的文件或目录\n-e 或 --rsh：指定远程 shell 程序，比如 ssh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h2",{attrs:{id:"例子"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#例子"}},[s._v("#")]),s._v(" 例子")]),s._v(" "),a("p",[a("strong",[s._v("本地同步")]),s._v("：rsync -av /source/dir /dest/dir")]),s._v(" "),a("p",[a("strong",[s._v("远程同步")])]),s._v(" "),a("p",[s._v("1.将本地目录 "),a("code",[s._v("/source/dir")]),s._v(" 同步到远程服务器上的 "),a("code",[s._v("/dest/dir")]),s._v("：rsync -avz /source/dir user@remote_host:/dest/dir")]),s._v(" "),a("p",[s._v("2.从远程服务器同步目录到本地：rsync -avz user@remote_host:/source/dir /dest/dir")]),s._v(" "),a("p",[a("strong",[s._v("带进度条和删除选项")])]),s._v(" "),a("p",[s._v("rsync -avz --progress --delete /html/www user@remote_host:/backup/www")]),s._v(" "),a("h2",{attrs:{id:"实操"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实操"}},[s._v("#")]),s._v(" 实操")]),s._v(" "),a("p",[a("strong",[s._v("使用 rsync 同步网站目录 /html/www 目录到 备份服务器上")])]),s._v(" "),a("p",[s._v("前提：")]),s._v(" "),a("p",[s._v("1.客户端和服务器都正常安装了 rsync 应用包")]),s._v(" "),a("p",[s._v("2.服务器开放了 rsync 的应用端口，默认 873，如果是云服务器，还需要额外在控制台配置安全组")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("iptables "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-A")]),s._v(" INPUT "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" tcp "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--dport")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("873")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-j")]),s._v(" ACCEPT\nfirewall-cmd --add-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("873")]),s._v("/tcp "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--permanent")]),s._v("\nfirewall-cmd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--reload")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("Start")]),s._v(" "),a("p",[s._v("1.服务端配置：/etc/rsync.conf，其中包含访问的用户、同步哪些文件夹、是否可改等配置信息")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("www"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#模块名")]),s._v("\npath "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /html/www/web_tool-master "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定模块对应的实际文件路径")]),s._v("\ncomment "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 我的静态web "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#模块的注释")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" only "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" no "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是否只读")]),s._v("\nlist "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是否允许列出模块中的文件")]),s._v("\nuid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" root "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定文件传输时使用的用户 ID")]),s._v("\ngid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" root "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定文件传输时使用的组 ID")]),s._v("\nauth "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("users")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" zzl "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#允许访问该模块的用户列表")]),s._v("\nsecrets "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /etc/rsync.secrets "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#用户列表存放文件路径")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("2.rsync.secrets （服务端）配置信息如下，然后配置文件权限：chmod 600 /etc/rsyncd.secrets")]),s._v(" "),a("p",[s._v("这允许客户端不指定密码文件直接输入密码进行登录")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("zzl:123456zzlZZL\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("3.启动 rsync 守护进程：sudo rsync --daemon --config=/etc/rsync.conf")]),s._v(" "),a("p",[s._v("4.在客户端同步文件：rsync -avz --progress zzl@49.235.177.56::www /html/www/web_tool-master")]),s._v(" "),a("p",[s._v("使用密码文件的方式：rsync -av --password-file=/etc/rsync.secrets /html/www/web_tool-master zzl@49.235.177.56::www")]),s._v(" "),a("p",[s._v("5.如果在更改过配置文件需要重启时，在 systemctl 等服务管理工具中找不到 rsync，那么可以先用 pkill 后，再重新启动守护进程")]),s._v(" "),a("p",[a("strong",[s._v("如果需要添加一个同步文件夹：")])]),s._v(" "),a("p",[s._v("在以上的基础上，需要先在服务器的 /etc/rsync.conf 配置需要同步的文件夹")]),s._v(" "),a("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20240720203851502-1721530608028-2.png",alt:"image-20240720203851502"}}),s._v(" "),a("p",[s._v("重启 rsync 服务")]),s._v(" "),a("p",[s._v("然后就可以在目标客户端进行拉取了")]),s._v(" "),a("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20240720204549485.png",alt:"image-20240720204549485"}}),s._v(" "),a("p",[a("strong",[s._v("如果需要在同步时排除文件/文件夹")])]),s._v(" "),a("p",[s._v("--exclude：可以使用多个 exclude 排除多个你不需要的文件/文件夹")]),s._v(" "),a("p",[s._v("rsync -avz --progress --exclude '10.txt' zzl@49.235.177.56::hots /var/temp/lost+found/exclude")]),s._v(" "),a("img",{staticStyle:{zoom:"80%"},attrs:{src:"/img/image-20240720210636373.png",alt:"image-20240720210636373"}}),s._v(" "),a("p",[s._v("把网站项目实时同步到备份服务器，利用脚本形式，"),a("strong",[s._v("做个定时任务，每5分钟执行同步一次")])]),s._v(" "),a("p",[s._v("在客户端建立 shell 脚本，如下，添加 执行权限")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rsync")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-avz")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--progress")]),s._v(" --password-file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/rsync.secrets"')]),s._v(" zzl@49.235.177.56::www /html/www/web_tool-master\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("在客户端设置连接密码的文件 /etc/rsync.secrets，在文件中只输入密码，然后给文件设置 600的权限")]),s._v(" "),a("p",[s._v("打开 crontab -e，编辑：*/5 * * * * /var/temp/lost+found/shell/cpHtml.sh > /dev/null")])])}),[],!1,null,null,null);a.default=r.exports}}]);