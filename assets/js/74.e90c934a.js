(window.webpackJsonp=window.webpackJsonp||[]).push([[74],{523:function(s,a,t){"use strict";t.r(a);var e=t(7),r=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("监控辅助工具：percona-zabbix-templates-1.1.8-1.noarch.rpm")]),s._v(" "),a("p",[s._v("监控模板：zbx_percona_mysql_template.xml")]),s._v(" "),a("p",[s._v("前提：监控工具需要 php 环境")]),s._v(" "),a("p",[s._v("将辅助工具安装在服务端，服务端通过工具远程连接需要监控的 mysql ，此时 mysql 需要对服务端访问的用户，如 root 用户，有对数据库读的权限，在之后，服务端通过访问本地 agent 来获取到 mysql 的监控信息")]),s._v(" "),a("p",[s._v("将辅助工具安装在客户端，客户端此时 如果使用 root 用户与 mysql进行交互，不需要注意权限问题，但是如果用新建用户，还是需要注意有读的权限，在之后，服务端通过访问远程 agent 来获取到 mysql 的监控信息")]),s._v(" "),a("p",[s._v("当需要监控多个不同客户端的mysql时，还是需要将辅助工具安装到客户端")]),s._v(" "),a("p",[a("strong",[s._v("演示1，当辅助工具安装在服务端监控远程mysql")])]),s._v(" "),a("p",[s._v("前提：客户端安装好了 mysql 并启动")]),s._v(" "),a("p",[s._v("前提：服务端安装好了 php 环境")]),s._v(" "),a("p",[s._v("1.在服务端安装 percona-zabbix-templates-1.1.8-1.noarch.rpm 包")]),s._v(" "),a("p",[s._v("rpm -Uvh [--force] percona-zabbix-templates-1.1.8-1.noarch.rpm")]),s._v(" "),a("p",[s._v("2.修改数据库连接参数：vim /var/lib/zabbix/percona/scripts/ss_get_mysql_stats.php")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$mysql_user")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'root'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$mysql_pass")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'123456'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$mysql_port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$mysql_socket")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/tmp/mysql.sock'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#填写正确的位置")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("3.修改数据库主机指向：vim /var/lib/zabbix/percona/scripts/get_mysql_stats_wrapper.sh，只用修改 HOST 就可以")]),s._v(" "),a("p",[s._v("接下来可以测试下脚本：./get_mysql_stats_wrapper.sh il，如果有值就没问题")]),s._v(" "),a("img",{staticStyle:{zoom:"80%"},attrs:{src:"D:\\file\\02-笔记\\02-运维\\assets\\image-20240827144551715.png",alt:"image-20240827144551715"}}),s._v(" "),a("p",[s._v("穿插一个步骤：如果 mysql 目标主机是远程主机，需要保证 mysql 的 root 用户可以在当前主机进行登录并且对数据库有查询的权限，如果没有登录或者是查询权限，在测试脚本时，不会有任何数据输出")]),s._v(" "),a("div",{staticClass:"language-mysql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("CREATE USER 'root'@'10.0.0.20' IDENTIFIED BY '123456';\nGRANT SELECT ON *.* TO 'root'@'10.0.0.20';\nFLUSH PRIVILEGES;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("4.将配置文件 userparameter_percona_mysql.conf 导入到 zabbix 客户端配置目录下")]),s._v(" "),a("p",[s._v("cp /var/lib/zabbix/percona/templates/userparameter_percona_mysql.conf /etc/zabbix/zabbix_agent2.d/mysql.conf")]),s._v(" "),a("p",[s._v("此文件的内容就是引用刚刚的脚本传入一些参数获取一些信息，刚刚测试时使用的参数也是这里拿的")]),s._v(" "),a("img",{staticStyle:{zoom:"80%"},attrs:{src:"D:\\file\\02-笔记\\02-运维\\assets\\image-20240827145318917.png",alt:"image-20240827145318917"}}),s._v(" "),a("p",[s._v("重启 zabbix-agent[2] 客户端：systemctl restart zabbix-agent2.service")]),s._v(" "),a("p",[s._v("接下来在 zabbix web 中导入 zbx_percona_mysql_template.xml 模板：配置 --\x3e 模板 --\x3e 导入")]),s._v(" "),a("img",{staticStyle:{zoom:"80%"},attrs:{src:"D:\\file\\02-笔记\\02-运维\\assets\\image-20240827145550955.png",alt:"image-20240827145550955"}}),s._v(" "),a("p",[s._v("配置 zabbix 主机，添加模板：Template Percona MySQL Server")]),s._v(" "),a("img",{staticStyle:{zoom:"80%"},attrs:{src:"D:\\file\\02-笔记\\02-运维\\assets\\image-20240827145657961.png",alt:"image-20240827145657961"}}),s._v(" "),a("p",[s._v("这个模板提供的监控项非常多，可以慢慢了解含义")]),s._v(" "),a("img",{staticStyle:{zoom:"80%"},attrs:{src:"D:\\file\\02-笔记\\02-运维\\assets\\image-20240827145832889.png",alt:"image-20240827145832889"}}),s._v(" "),a("p",[s._v("这些键值都是可以直接在服务端获取的")]),s._v(" "),a("img",{staticStyle:{zoom:"80%"},attrs:{src:"D:\\file\\02-笔记\\02-运维\\assets\\image-20240827150001782.png",alt:"image-20240827150001782"}}),s._v(" "),a("p",[s._v("监控客户机的mysql步骤都差不多，就是把工具包安装在客户机，获取客户机提供的参数c")])])}),[],!1,null,null,null);a.default=r.exports}}]);